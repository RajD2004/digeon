<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Profile - Digeon AI</title>
  <link rel="icon" href="/static/images/icon.png" type="image/png">

  <style>
    :root{
      --bg:#0f1216; --panel:#151a21; --panel-2:#121823; --text:#e6edf3; --muted:#9fb0c2;
      --brand:#19b6ad; --accent:#0077cc; --danger:#e63946; --border:#273141; --ring: rgba(125,211,252,.35);
    }
    html{color-scheme:dark;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    body { background: var(--bg); margin: 0; font-family: 'Inter', system-ui, Arial, sans-serif; color: var(--text); }
    a { color:#7dd3fc; text-decoration:none; } a:hover { text-decoration:underline; }

    .navbar { background: var(--panel); border-bottom: 1px solid var(--border); box-shadow: 0 6px 18px rgba(0,0,0,.25); position: sticky; top: 0; z-index: 100; }
    .navbar .container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 0 24px; height: 60px; }
    .logo img { height: 44px; border-radius: 6px; }
    .nav-links { list-style: none; display: flex; gap: 32px; margin: 0 0 0 20px; padding: 0; align-items: center; }
    .nav-links li a { color: var(--text); opacity: .9; }
    .cta-btn { background: var(--brand); color: #0b1117; padding: 10px 14px; border-radius: 10px; font-weight: 600; border: 1px solid #126a66; }
    .cta-btn:hover { filter: brightness(1.1); }

    .page { max-width: 1100px; margin: 42px auto; padding: 0 18px; }
    .header { display: flex; justify-content: space-between; align-items: center; gap: 16px; margin-bottom: 24px; }
    .header h1 { margin: 0; font-size: 1.9rem; color: var(--brand); }
    .whoami { color: var(--muted); font-size: .95rem; }

    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 14px; box-shadow: 0 8px 24px rgba(0,0,0,0.35); }
    .panel-header { padding: 18px 20px; border-bottom: 1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
    .panel-title { font-size: 1.15rem; }
    .panel-body { padding: 18px 20px 24px 20px; }

    .agents-grid { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 18px; }
    .agent-card { background: var(--panel-2); border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
    .agent-name { font-weight: 700; font-size: 1.05rem; margin: 0 0 8px 0; }
    .agent-desc { color: var(--muted); font-size: .95rem; margin-bottom: 10px; min-height: 2.4em; }
    .agent-meta { font-size: .85rem; color: #b7c7d8; margin-bottom: 12px; }
    .card-actions { display: flex; gap: 10px; }
    .btn { border: 1px solid var(--border); background: #0c141d; color: var(--text); border-radius: 10px; padding: 9px 12px; font-weight: 600; }
    .btn:hover { filter: brightness(1.12); }
    .btn-run { border-color: #1f7ab9; background: #0b1c2b; }
    .btn-delete { border-color: #5a2126; background: #1e0d11; color: #ffd4d8; } /* if you add “unassign” later */

    .empty { border: 1px dashed var(--border); border-radius: 12px; padding: 22px; text-align: center; color: var(--muted); }

    footer { margin: 36px 0 18px; }
    footer .container { max-width: 1100px; margin: 0 auto; padding: 20px 24px 12px 24px; text-align: center; font-size: 1rem; color: var(--muted); }
  </style>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="container">
        <a href="/" class="logo"><img src="/static/images/logo.png" alt="Digeon.ai logo"></a>
        <ul class="nav-links">
          <li><a href="newsletter">Newsletter</a></li>
          <li><a href="directory">Directory</a></li>
          <li><a href="marketplace">Marketplace</a></li>
          <li><a href="blog">Blog</a></li>
          <li><a href="contact">Contact Us</a></li>
        </ul>
        <a href="/developer/login" class="cta-btn">Developer Portal</a>
      </div>
    </nav>
  </header>

  <div class="page">
    <div class="header">
      <div>
        <h1>My Profile</h1>
        <div class="whoami">Signed in as <strong>{{ session.get('marketplace_user') or session.get('dev_user') or 'guest' }}</strong></div>
      </div>
      <button class="btn" onclick="localStorage.removeItem('marketplaceUser'); window.location.href='login';">Logout</button>
    </div>

    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">Purchased Agents</div>
      </div>
      <div class="panel-body">
        <div id="purchased-empty" class="empty" style="display:none;">You haven’t purchased any agents yet.</div>
        <div id="purchased-grid" class="agents-grid"></div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <p>&copy; 2025 Digeon AI. All rights reserved.</p>
    </div>
  </footer>

  <script>
  document.addEventListener('DOMContentLoaded', async () => {
    const grid = document.getElementById('purchased-grid');
    const empty = document.getElementById('purchased-empty');

    try {
      const resp = await fetch('/api/my-agents');
      if (resp.status !== 200) {
        grid.innerHTML = '<div class="empty">Please log in to view your purchases.</div>';
        return;
      }
      const agents = await resp.json();

      if (!agents || !agents.length) {
        empty.style.display = '';
        return;
      }

      grid.innerHTML = agents.map(a => `
        <div class="agent-card">
          <div class="agent-name">${a.name}</div>
          <div class="agent-desc">${a.description || ''}</div>
          <div class="agent-meta">Type: ${a.type || '—'} · Price: ${a.price ?? '—'}</div>
          <div class="card-actions">
            <a class="btn btn-run" href="/run-agent?name=${encodeURIComponent(a.name)}">Run</a>
          </div>
        </div>
      `).join('');
    } catch (e) {
      console.error(e);
      grid.innerHTML = '<div class="empty">Failed to load purchases.</div>';
    }
  });
  </script>
</body>
</html>
