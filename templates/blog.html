<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digeon AI - Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/static/images/icon.png" type="image/png">
  <style>
    body {
      background: #0e0f12;
      margin: 0;
      font-family: Arial, sans-serif;
      color: #eaeaea;
    }
    /* NAVBAR */
    .navbar {
      background: rgba(20, 20, 25, 0.9);
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.6);
      position: sticky;
      top: 0;
      z-index: 100;
      width: 100%;
      
    }
    .navbar .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      height: 60px;
    }
    .logo img {
      height: 44px;
      border-radius: 6px;
    }
    .nav-links {
      list-style: none;
      display: flex;
      gap: 32px;
      margin: 0;
      padding: 0;
    }
    .nav-links a {
      text-decoration: none;
      color: #eaeaea;
      font-weight: bold;
      font-size: 1.07rem;
      letter-spacing: 0.01em;
      border-bottom: 2px solid transparent;
      transition: color 0.22s, border-bottom 0.22s;
    }
    .nav-links a:hover {
      color: #19b6ad;
      border-bottom: 2px solid #19b6ad;
    }
    #site-search {
      display: flex;
      align-items: center;
    }
    #search-input {
      padding: 7px 12px;
      border: 1px solid #333;
      border-radius: 5px 0 0 5px;
      outline: none;
      font-size: 1rem;
      background: #1a1c20;
      color: #eaeaea;
    }
    #site-search button {
      padding: 7px 18px;
      border: none;
      background-color: #19b6ad;
      color: #fff;
      border-radius: 0 5px 5px 0;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.15s;
      font-size: 1rem;
    }
    #site-search button:hover {
      background-color: #138c86;
    }

    /* BLOG MAIN */
    main.container {
      max-width: 850px;
      margin: 0 auto;
      padding-bottom: 48px;
    }
    .blog-title {
      margin-top: 40px;
      text-align: center;
      font-size: 2.5rem;
      font-weight: 800;
      letter-spacing: -1px;
      color: #fff;
      margin-bottom: 22px;
    }
    #blog-admin-toolbar { display: block; margin: 36px 0 26px 0; text-align: right; }

    #blog-admin-toolbar button {
      background: #19b6ad;
      color: #fff;
      font-weight: 700;
      border: none;
      border-radius: 9px;
      padding: 12px 34px;
      font-size: 1.12rem;
      cursor: pointer;
      box-shadow: 0 2px 7px rgba(0,0,0,0.3);
      transition: background 0.18s, transform 0.18s;
    }
    #blog-admin-toolbar button:hover {
      background: #138c86;
      transform: translateY(-2px) scale(1.04);
    }
    #blog-list {
      margin-bottom: 48px;
      display: flex;
      flex-direction: column;
      gap: 34px;
    }
    .blog-card {
      background: rgba(30, 32, 38, 0.85);
      backdrop-filter: blur(6px);
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.4);
      padding: 34px 28px 28px 28px;
      max-width: 700px;
      margin: 0 auto;
      transition: transform 0.22s, box-shadow 0.22s;
      opacity: 0;
      transform: translateY(20px);
    }
    .blog-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 28px rgba(0,0,0,0.5);
    }
    .blog-card-title {
      font-size: 1.31rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
    }
    .blog-card-date {
      color: #aaa;
      font-size: 0.98rem;
      margin-bottom: 16px;
    }
    .blog-card-content {
      font-size: 1.13rem;
      color: #ccc;
      line-height: 1.63;
      word-break: break-word;
    }
    .blog-card img {
      max-width: 96%;
      margin: 0 0 16px 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .read-more {
      display: inline-block;
      margin-top: 14px;
      color: #19b6ad;
      font-weight: bold;
      text-decoration: none;
      transition: color 0.2s;
    }
    .read-more:hover {
      color: #138c86;
      text-decoration: underline;
    }

    /* POST MODAL */
    #post-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 999;
      background: rgba(0,0,0,0.6);
      align-items: center;
      justify-content: center;
    }
    #post-modal .modal-content {
      background: #1a1c20;
      color: #eaeaea;
      max-width: 500px;
      width: 95vw;
      padding: 40px 36px;
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      margin: auto;
      position: relative;
    }
    #post-modal .close-btn {
      position: absolute;
      right: 18px; top: 12px;
      font-size: 1.6rem;
      background: none;
      border: none;
      color: #aaa;
      cursor: pointer;
    }
    #post-modal h2 { margin: 0 0 18px; }
    #post-modal form { display: grid; row-gap: 14px; }
    #post-modal label { font-weight: 700; color: #fff; }
    #post-modal input[type="text"], 
    #post-modal textarea { 
      padding: 12px 14px;
      border-radius: 8px; 
      width: 100%;
      border: 1.4px solid #333;
      background: #1f2126;
      color: #eaeaea;
      font-size: 1.1rem;
      resize: vertical;
    }
    #post-modal textarea { min-height: 92px; }
    #add-link-btn, #post-modal button[type="submit"] { 
      background: #19b6ad;
      color: #fff;
      font-weight: 700;
      font-size: 1.15rem;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 1.5px 7px rgba(0,0,0,0.3);
    }
    #add-link-btn:hover, #post-modal button[type="submit"]:hover { background: #138c86; }

    /* FOOTER */
    footer {
      background: rgba(20, 20, 25, 0.95);
      padding: 20px;
      text-align: center;
    }
    .footer-social-bar {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
    }
    .footer-social-bar img, .footer-social-bar svg {
      width: 28px; height: 28px; opacity: 0.88;
      transition: opacity 0.16s, transform 0.16s;
    }
    .footer-social-bar img:hover, .footer-social-bar svg:hover {
      opacity: 1; transform: translateY(-3px) scale(1.1);
    }

    /* ANIMATIONS */
    .animate {
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .animate.visible {
      opacity: 1 !important;
      transform: translateY(0) !important;
    }
  </style>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">

</head>
<body>
  <!-- NAVBAR -->
  <header>
    <nav class="navbar">
      <div class="container">
        <a href="/" class="logo">
          <img src="/static/images/logo.png" alt="Digeon.ai logo">
        </a>
        <ul class="nav-links">
          <li><a href="newsletter">Newsletter</a></li>
          <li><a href="directory">Directory</a></li>
          <li><a href="marketplace">Marketplace</a></li>
          <li><a href="blog">Blog</a></li>
        </ul>
        <form id="site-search">
          <input type="text" id="search-input" placeholder="Search...">
          <button type="submit">Search</button>
        </form>
      </div>
    </nav>
  </header>

  <!-- MAIN -->
  <main class="container">
    <div class="blog-title animate">Bytes from Digeon</div>

    <div id="blog-list"></div>

    <!-- MODAL -->
    <div id="post-modal">
      <div class="modal-content">
        <button id="close-modal-btn" class="close-btn">&times;</button>
        <h2>Create Blog Post</h2>
        <form id="post-form" autocomplete="off">
          <label for="post-title">Title *</label>
          <input type="text" id="post-title" required>
          <label for="post-content">Content *</label>
          <textarea id="post-content" required rows="6"></textarea>
          <button type="button" id="add-link-btn">Insert Link</button>
          <div>
            <label for="post-image">Image:</label>
            <input type="file" id="post-image" accept="image/*">
            <div id="img-preview" style="margin-top:10px;display:none;">
              <img src="" id="img-preview-src">
            </div>
          </div>
          <button type="submit">Publish</button>
        </form>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 Digeon AI. All rights reserved.</p>
    <div class="footer-social-bar">
      <a href="https://x.com/digeonAI" target="_blank">
        <img src="https://cdn.simpleicons.org/x/FFFFFF" alt="X">
      </a>
      <a href="https://www.instagram.com/digeon.ai/" target="_blank">
        <img src="https://cdn.simpleicons.org/instagram/FFFFFF" alt="Instagram">
      </a>
      <a href="https://www.linkedin.com/company/digeon-ai/" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.026-3.037-1.849-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.354V9h3.414v1.561h.049c.476-.899 1.637-1.849 3.37-1.849 3.601 0 4.268 2.37 4.268 5.455v6.285zM4.091 9H.535V20.452h3.556V9zM2.313 2.526c-1.144 0-2.067.927-2.067 2.065 0 1.139.923 2.065 2.067 2.065 1.143 0 2.066-.926 2.066-2.065 0-1.138-.923-2.065-2.066-2.065z"/></svg>
      </a>
      <a href="mailto:Digeon.technologies@gmail.com">
        <img src="https://cdn.simpleicons.org/gmail/FFFFFF" alt="Gmail">
      </a>
    </div>
  </footer>
  <script>
    
    const modal = document.getElementById('post-modal');

  
    document.getElementById('create-post-btn').onclick = () => { modal.style.display = 'flex'; };
    document.getElementById('close-modal-btn').onclick = () => { modal.style.display = 'none'; };

    document.getElementById('post-form').onsubmit = async function(e) {
      e.preventDefault();
      const title = document.getElementById('post-title').value.trim();
      const content = document.getElementById('post-content').value.trim();
      let imageData = '';
      const img = document.getElementById('post-image').files[0];
      if (img) {
        const reader = new FileReader();
        reader.onload = async (ev) => {
          imageData = ev.target.result;
          await savePost(title, content, imageData);
        };
        reader.readAsDataURL(img);
      } else {
        await savePost(title, content, imageData);
      }
    };

    async function savePost(title, content, imageData){
      if (!title || !content) return alert("Title and content are required!");
      await fetch("/api/blogs", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({title, content, imageData})
      });
      modal.style.display = 'none';
      document.getElementById('post-form').reset();
      document.getElementById('img-preview').style.display = 'none';
      renderBlog();
    }
  

  // Re-run animation observer for new posts
  document.querySelectorAll('.blog-card').forEach(el => {
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
      });
    }, { threshold: 0.15 });
    observer.observe(el);
  });



    function escapeHTML(str) {
      return String(str).replace(/[<>&"']/g, m => (
        {'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;',"'":'&#39;'}[m]
      ));
    }

    renderBlog()
    window.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };
  </script>

  

  <script>
  async function renderBlog() {
    const res = await fetch("/api/blogs");
    const posts = await res.json();
    const list = document.getElementById('blog-list');

    if (!posts.length) {
      list.innerHTML = `<div style="text-align:center;color:#888;font-size:1.18rem;margin-top:36px;">No blog posts yet.</div>`;
      return;
    }

    list.innerHTML = posts.map(post => {
      const preview = post.content.length > 180
        ? escapeHTML(post.content.substring(0, 180)) + "…"
        : escapeHTML(post.content);
      const when = new Date(post.created_at).toLocaleString();
      return `
        <div class="blog-card animate">
          ${post.image ? `<img src="${post.image}" alt="">` : ""}
          <div class="blog-card-title">
            <a href="/post?id=${post.blog_id}" style="color:#fff;text-decoration:none;">
              ${escapeHTML(post.title)}
            </a>
          </div>
          <div class="blog-card-date">${when}</div>
          <div class="blog-card-content">${preview}</div>
          <a href="/post?id=${post.blog_id}" class="read-more">Read More →</a>
        </div>
      `;
    }).join('');

    // fade-in animation
    document.querySelectorAll('.blog-card').forEach(el => {
      const ob = new IntersectionObserver(es => es.forEach(e => e.isIntersecting && e.target.classList.add('visible')), {threshold:0.15});
      ob.observe(el);
    });
  }

  function escapeHTML(str){
    return String(str).replace(/[<>&"']/g, m => ({'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;',"'":'&#39;'}[m]));
  }
  renderBlog();
  </script>


  
</body>
</html>
